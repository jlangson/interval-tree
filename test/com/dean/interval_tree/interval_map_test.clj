(ns com.dean.interval-tree.interval-map-test
  (:require [clojure.test       :refer :all]
            [com.dean.interval-tree.core :refer [interval-map]]))


;; x8:                         +-----+
;; x7:                   +-----------------------------------+
;; x6:                                                       +
;; x5:                                     +-----------+
;; x4: +-----------------------------+
;; x3:                                                 +-----+
;; x2:                         +-----------------+
;; x1:       +-----------+
;;
;;     0=====1=====2=====3=====4=====5=====6=====7=====8=====9

(deftest interval-query-check
  (let [x (interval-map {[1 3] :x1
                         [4 7] :x2
                         [8 9] :x3
                         [0 5] :x4
                         [6 8] :x5
                         [9 9] :x6
                         [3 9] :x7
                         [4 5] :x8})]
    (comment                                                ; for repl
      (def x (interval-map {[1 3] :x1
                            [4 7] :x2
                            [8 9] :x3
                            [0 5] :x4
                            [6 8] :x5
                            [9 9] :x6
                            [3 9] :x7
                            [4 5] :x8})))
    (testing "pointwise query"   ;; note: order returned determined by interval start
      (is (empty?               (x -1.00000000)))
      (is (empty?               (x -0.00000001)))
      (is (= [:x4]              (x  0.00000000)))
      (is (= [:x4]              (x  0.00000000001)))
      (is (= [:x4]              (x  0.99999999999)))
      (is (= [:x4 :x1]          (x  1)))
      (is (= [:x4 :x1]          (x  1.8675309)))
      (is (= [:x4 :x1]          (x  2.0)))
      (is (= [:x4 :x1]          (x  2.99999999)))
      (is (= [:x4 :x1 :x7]      (x  3)))
      (is (= [:x4 :x7]          (x  3.00000001)))
      (is (= [:x4 :x7]          (x  3.99999999)))
      (is (= [:x4 :x7 :x8 :x2]  (x  4)))
      (is (= [:x4 :x7 :x8 :x2]  (x  5)))
      (is (= [:x7 :x2]          (x  5.00000001)))
      (is (= [:x7 :x2 :x5]      (x  6)))
      (is (= [:x7 :x2 :x5]      (x  7)))
      (is (= [:x7 :x5]          (x  7.00000001)))
      (is (= [:x7 :x5]          (x  7.99999999)))
      (is (= [:x7 :x5 :x3]      (x  8)))
      (is (= [:x7 :x3]          (x  8.00000001)))
      (is (= [:x7 :x3]          (x  8.99999999)))
      (is (= [:x7 :x3 :x6]      (x  9)))
      (is (empty?               (x  9.00000001))))
    (testing "interval query"
      (is (= [:x4]                             (x [0 0])))
      (is (= [:x4]                             (x [0 0.5])))
      (is (= [:x4 :x1]                         (x [0 1.0])))
      (is (= [:x4 :x1]                         (x [0 1.5])))
      (is (= [:x4 :x1]                         (x [0 2.0])))
      (is (= [:x4 :x1]                         (x [0 2.5])))
      (is (= [:x4 :x1 :x7]                     (x [0 3.0])))
      (is (= [:x4 :x1 :x7]                     (x [0 3.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [0 4.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [0 4.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [0 5.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [0 5.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [0 6.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [0 6.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [0 7.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [0 7.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [0 8.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [0 8.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [0 9.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [0 9.5])))
      (is (= [:x4 :x1]                         (x [1 1])))
      (is (= [:x4 :x1]                         (x [1 1.5])))
      (is (= [:x4 :x1]                         (x [1 2.0])))
      (is (= [:x4 :x1]                         (x [1 2.5])))
      (is (= [:x4 :x1 :x7]                     (x [1 3.0])))
      (is (= [:x4 :x1 :x7]                     (x [1 3.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [1 4.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [1 4.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [1 5.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [1 5.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [1 6.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [1 6.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [1 7.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [1 7.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [1 8.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [1 8.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [1 9.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [1 9.5])))
      (is (= [:x4 :x1]                         (x [2 2])))
      (is (= [:x4 :x1]                         (x [2 2.5])))
      (is (= [:x4 :x1 :x7]                     (x [2 3.0])))
      (is (= [:x4 :x1 :x7]                     (x [2 3.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [2 4.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [2 4.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [2 5.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [2 5.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [2 6.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [2 6.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [2 7.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [2 7.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [2 8.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [2 8.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [2 9.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [2 9.5])))
      (is (= [:x4 :x1 :x7]                     (x [3 3])))
      (is (= [:x4 :x1 :x7]                     (x [3 3.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [3 4.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [3 4.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [3 5.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2]             (x [3 5.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [3 6.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [3 6.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [3 7.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5]         (x [3 7.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [3 8.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3]     (x [3 8.5])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [3 9.0])))
      (is (= [:x4 :x1 :x7 :x8 :x2 :x5 :x3 :x6] (x [3 9.5])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [4 4])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [4 4.5])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [4 5.0])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [4 5.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [4 6.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [4 6.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [4 7.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [4 7.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3]         (x [4 8.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3]         (x [4 8.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3 :x6]     (x [4 9.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3 :x6]     (x [4 9.5])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [5 5])))
      (is (= [:x4 :x7 :x8 :x2]                 (x [5 5.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [5 6.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [5 6.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [5 7.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5]             (x [5 7.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3]         (x [5 8.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3]         (x [5 8.5])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3 :x6]     (x [5 9.0])))
      (is (= [:x4 :x7 :x8 :x2 :x5 :x3 :x6]     (x [5 9.5])))
      (is (= [:x7 :x2 :x5]                     (x [6 6])))
      (is (= [:x7 :x2 :x5]                     (x [6 6.5])))
      (is (= [:x7 :x2 :x5]                     (x [6 7.0])))
      (is (= [:x7 :x2 :x5]                     (x [6 7.5])))
      (is (= [:x7 :x2 :x5 :x3]                 (x [6 8.0])))
      (is (= [:x7 :x2 :x5 :x3]                 (x [6 8.5])))
      (is (= [:x7 :x2 :x5 :x3 :x6]             (x [6 9.0])))
      (is (= [:x7 :x2 :x5 :x3 :x6]             (x [6 9.5])))
      (is (= [:x7 :x2 :x5]                     (x [7 7])))
      (is (= [:x7 :x2 :x5]                     (x [7 7.5])))
      (is (= [:x7 :x2 :x5 :x3]                 (x [7 8.0])))
      (is (= [:x7 :x2 :x5 :x3]                 (x [7 8.5])))
      (is (= [:x7 :x2 :x5 :x3 :x6]             (x [7 9.0])))
      (is (= [:x7 :x2 :x5 :x3 :x6]             (x [7 9.5])))
      (is (= [:x7 :x5 :x3]                     (x [8 8])))
      (is (= [:x7 :x5 :x3]                     (x [8 8.5])))
      (is (= [:x7 :x5 :x3 :x6]                 (x [8 9.0])))
      (is (= [:x7 :x5 :x3 :x6]                 (x [8 9.5])))
      (is (= [:x7 :x3 :x6]                     (x [9 9])))
      (is (= [:x7 :x3 :x6]                     (x [9 9.5]))))))
